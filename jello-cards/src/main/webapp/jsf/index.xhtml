<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
     
    <h:head>
        <title>Jello</title>
    </h:head>
 
    <h:body id="body">

        <style type="text/css">
            .ui-panel, div.ui-state-hover {
                margin: 10px;
            }
            .ui-dashboard-column {
                width:25%;
            }
            .ui-panelgrid .ui-grid-responsive .ui-panelgrid-cell {
                text-align: center;
            }
        </style>
        
        <p:panelGrid columns="4" layout="grid">            

            <h:panelGroup layout="block">
                <h2><i class="fa fa-fw fa-list-ol"></i> Pipeline</h2>
            </h:panelGroup>
            <h:panelGroup layout="block">
                <h2><i class="fa fa-fw fa-code"></i> Development</h2>
            </h:panelGroup>
            <h:panelGroup layout="block">
                <h2><i class="fa fa-fw fa-check-square-o"></i> Testing</h2>
            </h:panelGroup>
            <h:panelGroup layout="block">
                <h2><i class="fa fa-fw fa-cloud-upload"></i> Release</h2>
            </h:panelGroup>

        </p:panelGrid>

        <h:panelGroup layout="block" id="main">
            <p:growl id="growl" showDetail="true" />
            
            <h:form>
                <p:dashboard id="board" model="#{cardController.model}">
                    <p:ajax event="reorder" listener="#{cardController.handleReorder}" update="growl" />

                    <c:forEach var="card" items="#{cardController.cards}">
                        
                        <p:panel id="card_#{card.id}" header="#{card.title}">
                            <h:panelGrid style="width:100%">
                                <p:row>
                                    <p:column colspan="3">
                                        <h:outputText value="#{card.created}" class="pull-right">
                                            <f:convertDateTime type="localDateTime" pattern="dd MMMM yyyy ' at ' HH:mm" />
                                        </h:outputText>
                                    </p:column>
                                </p:row>
                                
                                <p:row>
                                    <p:column colspan="3">
                                        <p>
                                            <h:outputText value="#{card.description}" />
                                        </p>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column colspan="3">
                                        <p:menubar>
                                            <p:menuitem value="Delete" action="#{cardController.deleteCardDialog(card)}" icon="pi pi-times" update="main"/>
                                            <p:menuitem value="Edit" action="#{cardController.editCardDialog(card)}" icon="pi pi-pencil" update="main"/>
                                            <p:menuitem value="#{card.numberOfComments} comments" action="#{cardController.viewCommentsDialog(card)}" icon="pi pi-comment" update="main"/>
                                        </p:menubar>
                                    </p:column>
                                </p:row>
                            </h:panelGrid>
                        </p:panel>
                        
                    </c:forEach>
                </p:dashboard>
            </h:form>
            
            <div style="clear:both" />

            <!-- Add card dialog -->
            <h:form>
                <h:outputLink value="javascript:void(0)" onclick="PF('addCardDialog').show();" title="addCardDialog">
                    <i class="pi pi-plus-circle pull-right" style="font-size: 4em"></i>
                </h:outputLink>

                <p:dialog id="addCardDialog" header="Add Card" widgetVar="addCardDialog" modal="true" draggable="true" >
                    <p:ajax event="close" listener="#{cardController.handleDialogClose}" update="growl" />
                    
                    <p:panelGrid id="idPanelAddCard" styleClass="ui-noborder">
                        <p:row>
                            <p:column>
                                <p:outputLabel for="addCardTitle" value="Title:" />
                            </p:column>
                            <p:column colspan="3">
                                <p:inputText  id="addCardTitle" 
                                              value="#{cardController.newCard.title}" 
                                              pt:required="true" 
                                              label="Title"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                <p:outputLabel for="addCardDescription" value="Description:" />
                            </p:column>
                            <p:column colspan="3">
                                <p:inputTextarea id="addCardDescription" 
                                                 value="#{cardController.newCard.description}" 
                                                 pt:required="true" 
                                                 label="Description" 
                                                 cols="40" 
                                                 rows="10"/>
                            </p:column>
                        </p:row>
                    </p:panelGrid>

                    <p:commandButton value="Add Card" update="main" action="#{cardController.addCard()}"
                                         oncomplete="PF('addCardDialog').hide();" style="float:right;" />

                </p:dialog>  
            </h:form>        
            
            <!-- Edit dialog -->
            <h:form>
                <p:dialog id="editCardDialog" header="Edit #{cardController.selectedCard.title}" widgetVar="editCardDialog" modal="true" draggable="true">
                    <p:ajax event="close" listener="#{cardController.handleDialogClose}" update="growl" />
                    <p:panelGrid style="margin-top:20px" styleClass="ui-noborder">

                        <p:row>
                            <p:column>
                                <p:outputLabel for="editCardTitle" value="Title:" />
                            </p:column>
                            <p:column colspan="3">
                                <p:inputText  id="editCardTitle" 
                                              value="#{cardController.selectedCard.title}" 
                                              pt:required="true" 
                                              label="Title"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                <p:outputLabel for="editCardDescription" value="Description:" />
                            </p:column>
                            <p:column colspan="3">
                                <p:inputTextarea id="editCardDescription" 
                                                 value="#{cardController.selectedCard.description}" 
                                                 pt:required="true" 
                                                 label="Description" 
                                                 cols="40" 
                                                 rows="10"/>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    
                    <p:commandButton value="Edit Card" update="main" action="#{cardController.editCard()}"
                                             oncomplete="PF('editCardDialog').hide();" style="float:right;" />
                </p:dialog>
            </h:form>
            
            <!-- Delete Dialog -->
            <h:form>
                <p:dialog id="deleteCardDialog" header="Delete #{cardController.selectedCard.title}" widgetVar="deleteCardDialog" modal="true" draggable="true">
                    <p:ajax event="close" listener="#{cardController.handleDialogClose}" update="growl" />
                    <p:panelGrid style="margin-top:20px" styleClass="ui-noborder">

                        <p:row>
                            <p:column>
                                <p:outputLabel for="deleteCardTitle" value="Title:" />
                            </p:column>
                            <p:column colspan="3">
                                <p:outputLabel id="deleteCardTitle" value="#{cardController.selectedCard.title}" />
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                <p:outputLabel for="deleteCardDescription" value="Description:" />
                            </p:column>
                            <p:column colspan="3">
                                <p:outputLabel id="deleteCardDescription" value="#{cardController.selectedCard.description}" />
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    
                    <p:commandButton value="Delete Card" update="main" action="#{cardController.deleteCard()}"
                                             oncomplete="PF('confirmDeleteDialog').hide();" style="float:right;" />
                </p:dialog>
            </h:form>
            
            <!-- View comments -->
            <h:form>
                <p:dialog id="viewCommentsDialog" header="Comments on #{cardController.selectedCard.title}" widgetVar="viewCommentsDialog" modal="true" draggable="true">
                    <p:ajax event="close" listener="#{cardController.handleDialogClose}" update="growl" />
                    <p:panelGrid style="margin-top:20px" styleClass="ui-noborder">
                        <ui:repeat value="#{cardController.selectedCard.comments}" var="comment">
                        
                            <p:row>
                                <p:column style="font-weight: bold;">#{comment.madeBy}</p:column>
                                <p:column styleClass="pull-right">#{comment.madeOn}</p:column>
                            </p:row>
                        
                            <p:row>
                                <p:column colspan="2">#{comment.comment}</p:column>
                            </p:row>

                        </ui:repeat>
                        <f:facet name="footer">
                            <p:row>
                                <p:column colspan="2" style="text-align: center">
                                    TODO: Add Comment
                                </p:column>                                
                            </p:row>
                        </f:facet>
                    
                    </p:panelGrid>
                </p:dialog>
            </h:form>
            
        </h:panelGroup>
        
    </h:body>
</html>