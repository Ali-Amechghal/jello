<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:pt="http://xmlns.jcp.org/jsf/passthrough">
     
    <h:head>
        <title>Jello</title>
    </h:head>
 
    <h:body id="body">

        <style type="text/css">
            .ui-panel, div.ui-state-hover {
                margin: 10px;
            }
            .ui-dashboard-column {
                width:25%;
            }
            .ui-panelgrid .ui-grid-responsive .ui-panelgrid-cell {
                text-align: center;
            }
        </style>
        
        <p:panelGrid columns="4" layout="grid">            

            <h:panelGroup layout="block">
                <h2><i class="fa fa-fw fa-list-ol"></i> Pipeline</h2>
            </h:panelGroup>
            <h:panelGroup layout="block">
                <h2><i class="fa fa-fw fa-code"></i> Development</h2>
            </h:panelGroup>
            <h:panelGroup layout="block">
                <h2><i class="fa fa-fw fa-check-square-o"></i> Testing</h2>
            </h:panelGroup>
            <h:panelGroup layout="block">
                <h2><i class="fa fa-fw fa-cloud-upload"></i> Release</h2>
            </h:panelGroup>

        </p:panelGrid>

        <h:panelGroup layout="block" id="main">
            <p:growl id="growl" showDetail="true" />
            
            <h:form>
                <p:dashboard id="board" model="#{cardController.model}">
                    <p:ajax event="reorder" listener="#{cardController.handleReorder}" update="growl" />

                    <c:forEach var="card" items="#{cardController.cards}">
                        
                        <p:panel id="card_#{card.id}" header="#{card.title}" closable="true">
                            <p:ajax event="close" listener="#{cardController.handleClose}" update="growl" />
                            <h:panelGrid columns="1" style="width:100%">
                                <h:outputText value="#{card.created}" class="pull-right">
                                    <f:convertDateTime type="localDateTime" pattern="dd MMMM yyyy ' at ' HH:mm" />
                                </h:outputText>
                                <p>
                                    <h:outputText value="#{card.description}" />
                                </p>

                                <br/>
                                <p:commandLink id="comments_#{card.id}" update="viewCommentsDialog" action="#{cardController.viewCommentsDialog(card)}">
                                    <i class="pi pi-comment"></i> <h:outputText value="#{card.numberOfComments} comments"/>
                                </p:commandLink>
                                <p:commandLink id="edit_#{card.id}" update="editCardDialog" action="#{cardController.editCardDialog(card)}" class="pull-right">
                                    <i class="pi pi-pencil"></i> <h:outputText value="edit"/>
                                </p:commandLink>
                            </h:panelGrid>
                        </p:panel>
                        
                    </c:forEach>
                </p:dashboard>
            </h:form>
            
            <div style="clear:both" />

            <!-- Add card dialog -->
            <h:form>
                <h:outputLink value="javascript:void(0)" onclick="PF('addCardDialog').show();" title="addCardDialog">
                    <i class="pi pi-plus-circle pull-right" style="font-size: 4em"></i>
                </h:outputLink>

                <p:dialog id="addCardDialog" header="Add Card" widgetVar="addCardDialog" modal="true" draggable="true" >

                    <p:panelGrid id="idPanelAddCard" styleClass="ui-noborder">
                        <p:row>
                            <p:column>
                                <p:outputLabel for="addCardTitle" value="Title:" />
                            </p:column>
                            <p:column colspan="3">
                                <p:inputText  id="addCardTitle" 
                                              value="#{cardController.card.title}" 
                                              pt:required="true" 
                                              label="Title"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                <p:outputLabel for="addCardDescription" value="Description:" />
                            </p:column>
                            <p:column colspan="3">
                                <p:inputTextarea id="addCardDescription" 
                                                 value="#{cardController.card.description}" 
                                                 pt:required="true" 
                                                 label="Description" 
                                                 cols="40" 
                                                 rows="10"/>
                            </p:column>
                        </p:row>
                    </p:panelGrid>

                    <p:commandButton value="AddCard" update="main" action="#{cardController.addCard()}"
                                         oncomplete="PF('addCardDialog').hide();" style="float:right;" />

                </p:dialog>  
            </h:form>        
            
            <!-- Edit dialog -->
            <p:dialog id="editCardDialog" header="Edit #{cardController.card.title}" widgetVar="editCardDialog" modal="true" draggable="true">
                <h:form>
                    <p:panelGrid style="margin-top:20px" styleClass="ui-noborder">

                        <p:row>
                            <p:column>
                                <p:outputLabel for="editCardTitle#{cardController.card.id}" value="Title:" />
                            </p:column>
                            <p:column colspan="3">
                                <p:inputText  id="editCardTitle#{cardController.card.id}" 
                                              value="#{cardController.card.title}" 
                                              pt:required="true" 
                                              label="Title"/>
                            </p:column>
                        </p:row>
                        <p:row>
                            <p:column>
                                <p:outputLabel for="editCardDescription#{cardController.card.id}" value="Description:" />
                            </p:column>
                            <p:column colspan="3">
                                <p:inputTextarea id="editCardDescription#{cardController.card.id}" 
                                                 value="#{cardController.card.description}" 
                                                 pt:required="true" 
                                                 label="Description" 
                                                 cols="40" 
                                                 rows="10"/>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    
                    <p:commandButton value="EditCard" update="main" action="#{cardController.editCard()}"
                                             oncomplete="PF('editCardDialog').hide();" style="float:right;" />
                    
                </h:form>
            </p:dialog>
            
            <!-- View comments -->
            <p:dialog id="viewCommentsDialog" header="Comments on #{cardController.card.title}" widgetVar="viewCommentsDialog" modal="true" draggable="true">
                
                <p:panelGrid style="margin-top:20px" styleClass="ui-noborder">
                    <ui:repeat value="#{cardController.card.comments}" var="comment">
                        
                        <p:row>
                            <p:column style="font-weight: bold;">#{comment.madeBy}</p:column>
                            <p:column styleClass="pull-right">#{comment.madeOn}</p:column>
                        </p:row>
                        
                        <p:row>
                            <p:column colspan="2">#{comment.comment}</p:column>
                        </p:row>

                    </ui:repeat>
                    <f:facet name="footer">
                        <p:row>
                            <p:column colspan="2" style="text-align: center">
                                TODO: Add Comment
                            </p:column>
                                
                        </p:row>
                    </f:facet>
                    
                </p:panelGrid>
                
            </p:dialog>
            
        </h:panelGroup>
        
    </h:body>
</html>